<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width'>
  <title>dB vs Freq Plot</title>

</head>
<body>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/4.10.0/d3.min.js'></script>
  <script>

//get the data
var myFilter = [['Freq', 'InsertionLoss', 'ReturnLoss', 'NoiseFigure'],
				[ 40,  20,  25, 50],
				[ 80,  30,  40, 55],
				[120,  80,  90, 60],
				[160, 100, 105, 65],
				[200, 120, 130, 70]];

//var color = d3.schemeCategory10;
var color = d3.schemeCategory10;
			
//function to turn data into tsv
var tsv = '';
myFilter.forEach( (element) => {
    tsv += element.join('\t') + '\n';
});
  
//use d3 to turn tsv data into d3 data
var data = d3.tsvParse(tsv);

//use d3 columns to find
var zIndex = data.columns.slice(1)

//change data type from string to float		
data.forEach( (d) => {
	d.Freq = +d.Freq;
	d.InsertionLoss = +d.InsertionLoss;
	d.ReturnLoss = +d.ReturnLoss;
});
  
//change the data to dBs
var dBs = data.columns.slice(1).map(function(name) { //2 iterations
	return {
		name    : name, // name = "InsertionLoss" and "ReturnLoss"
		values: data.map(function(d) { //10 iterations
			return {Freq: d.Freq , dB: d[name], z: name};
			})
	};
});

//create the svg
var outerWidth = 500;
var outerHeight = 250;
var margin = { left: 70, top: 10, right: 20, bottom: 60 };
var innerWidth  = outerWidth  - margin.left - margin.right;
var innerHeight = outerHeight - margin.top  - margin.bottom;
var xAxisTitle = "Frequency, GHz";
var xAxisTitleOffset = 48;
var yAxisTitle = "RTN Loss, dB";
var yAxisTitleOffset = 40;
var svg = d3.select('body').append('svg')
    .attr('width', outerWidth)
	.attr('height', outerHeight)

//create rect around svg
var rect = svg.append('rect')
.attr("width", outerWidth)
.attr("height", outerHeight)
.attr('fill', 'none')
.attr('stroke', 'black')
.attr('stroke-width', '1px');

//scale the data
var xScale = d3.scaleLinear().rangeRound([0, innerWidth]);
var yScale = d3.scaleLinear().rangeRound([0, innerHeight]);

xScale.domain( d3.extent(data, function (d){ return d['Freq']; }));

yScale.domain([
d3.min(dBs, function(c) { return d3.min(c.values, function(d) { return d['dB']; }); }),
d3.max(dBs, function(c) { return d3.max(c.values, function(d) { return d['dB']; }); })
]);

//append the plot area inside the svg
var g = svg.append('g')
	.attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
	.attr('class', 'plotArea');
										
//append the x axis onto g
g.append('g')
	.attr('class', 'xAxis')
	.style('font-size', '12')
	.attr('transform', 'translate(0,' + innerHeight + ')')
	.call(d3.axisBottom(xScale))
	.append('text')
	.attr("fill", "#000")
	.style("text-anchor", "middle")
	.attr("transform", "translate(" + (innerWidth / 2) + "," + xAxisTitleOffset + ")")
	.style('font-size', '20')
	.text(xAxisTitle);

//append the x axix grid onto g
g.append('g')
	.attr("class", "xGrid")
	.attr('transform', 'translate(0,' + innerHeight + ')')
	.call(d3.axisBottom(xScale).tickSize(-innerHeight).tickFormat(""));
d3.select('g').select('g.xGrid').selectAll('g').select('line')
	.attr('stroke', 'gray').attr('stroke-dasharray', '3, 3');
	
//append the y axis onto g
g.append('g')
	.attr('class', 'yAxis')
	.style('font-size', '12')
	.call(d3.axisLeft(yScale))
	.append('text')
	.attr("fill", "#000")
	.style("text-anchor", "middle")
	.attr("transform", "translate(-" + yAxisTitleOffset + "," + (innerHeight / 2) + ") rotate(-90)")
	.style('font-size', '20')
	.text(yAxisTitle);

//append the x axis grid onto g
g.append('g')
	.attr("class", "yGrid")
	.call(d3.axisLeft(yScale).tickSize(-innerWidth).tickFormat("")); 
d3.select('g').select('g.yGrid').selectAll('g').select('line')
	.attr('stroke', 'gray').attr('stroke-dasharray', '3, 3');
	
// define line-dot as "dB"
var dB = svg.selectAll()
	.data(dBs)
	.enter().append("g")
	.attr("class", "dB")
	.attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

//create the line attribute for the path
var line = d3.line()
	.x(function(d) { return xScale(d['Freq']); })
	.y(function(d) { return yScale(d['dB']); })
	.curve(d3.curveCatmullRom.alpha(.4));

//create a path element and draw the path
dB.append("path")
	.attr("class", "line")
	.attr("d", function(d) {  return line(d.values);})
	.attr('fill', 'none').attr('stroke', 'blue')
	.attr('stroke-width', '2px')
	.style("stroke", function(d, i) { return color[i]; });
	
//create the circle elements and draw the dots
dB.selectAll("circle")
	.data(function(d){  return d.values})
	.enter()
	.append("circle")
	.attr("r", 3)
	.attr("cx", function(d) { return xScale(d.Freq); })
	.attr("cy", function(d) { return yScale(d.dB); })
	.style("fill", function(d) { return color[zIndex.indexOf(d.z)]; });
	
</script></body></html>